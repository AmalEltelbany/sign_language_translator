<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice to Sign Language</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #fff; display: flex; justify-content: center; }
        .container { text-align: center; max-width: 600px; }
        h1 { font-size: 2em; color: #333; margin-bottom: 10px; }
        p.subtitle { color: #666; margin-bottom: 20px; }
        .tabs { margin-bottom: 20px; }
        .tabs button { padding: 10px 20px; margin: 0 10px; background-color: #007BFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .tabs button:hover { background-color: #0056b3; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .input-area { background-color: #e6f0fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; position: relative; }
        .input-area textarea { width: 100%; height: 100px; padding: 10px; border: none; background: transparent; resize: none; }
        .input-area .icon { position: absolute; top: 20px; left: 20px; font-size: 1.5em; color: #007BFF; }
        .input-area .counter { position: absolute; bottom: 10px; right: 10px; color: #666; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; border: none; }
        .btn-primary { background-color: #007BFF; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #dc3545; color: white; }
        .btn-secondary:hover { background-color: #c82333; }
        #recording-timer { font-weight: bold; margin: 10px 0; }
        #progress { margin: 20px 0; }
        #progress-bar { width: 100%; background: #ddd; height: 10px; border-radius: 5px; }
        #progress-fill { height: 100%; background: #007BFF; width: 0%; border-radius: 5px; transition: width 0.5s; }
        video { max-width: 100%; margin: 20px 0; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Voice to Sign Language</h1>
        <p class="subtitle">Upload audio, record voice, or type text to convert into sign language video</p>

        <div class="tabs">
            <button class="btn-primary" onclick="openTab('upload')">Upload Audio</button>
            <button class="btn-primary" onclick="openTab('record')">Record Voice</button>
            <button class="btn-primary" onclick="openTab('text')">Type Text</button>
        </div>

        <div id="upload" class="tab-content active">
            <div id="drop-zone" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)" ondrop="dropHandler(event)">
                <p>Drag and drop your audio file here or click the button below to select a file</p>
                <input type="file" id="audio-file" accept="audio/*" onchange="handleFileSelect(event)" style="display: none;">
                <button class="btn-primary" onclick="document.getElementById('audio-file').click()">Upload Audio</button>
            </div>
        </div>

        <div id="record" class="tab-content">
            <p>Record your voice message</p>
            <p id="recording-timer">00:00</p>
            <button id="start-record" class="btn-primary" onclick="startRecording()">Start Recording</button>
            <button id="stop-record" class="btn-secondary hidden" onclick="stopRecording()">Stop Recording</button>
            <button id="use-record" class="btn-primary hidden" onclick="useRecording()">Use Recording</button>
        </div>

        <div id="text" class="tab-content">
            <div class="input-area">
                <span class="icon">ðŸ“„</span> <!-- Placeholder for document icon -->
                <textarea id="text-input" placeholder="Type your message to convert to sign language" maxlength="1000" oninput="updateTextCounter()"></textarea>
                <span class="counter" id="text-counter">0/1000</span>
            </div>
            <button class="btn-secondary" onclick="clearText()">Clear Text</button>
            <button class="btn-primary" onclick="convertText()">Convert Text</button>
        </div>

        <div id="preview" class="tab-content hidden">
            <div class="input-area">
                <span class="icon">ðŸ“„</span>
                <p id="preview-text"></p>
            </div>
            <button class="btn-primary" onclick="confirmConversion()">Convert to Sign Language</button>
            <button class="btn-secondary" onclick="newInput()">New Input</button>
        </div>

        <div id="progress" class="tab-content hidden">
            <p>Converting your text to sign language video...</p>
            <div id="progress-bar"><div id="progress-fill"></div></div>
        </div>

        <div id="result" class="tab-content hidden">
            <h2>Sign Language Video</h2>
            <video id="sign-video" controls></video>
            <a id="download-video" class="btn-primary" href="#" download="sign_language_video.mp4">Download Video</a>
            <button class="btn-secondary" onclick="newInput()">New Conversion</button>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let recordedChunks = [];
        let recordingTimer;
        let textToConvert = '';

        // Tab Navigation
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            resetUI();
        }

        // Reset UI
        function resetUI() {
            document.getElementById('preview').classList.add('hidden');
            document.getElementById('progress').classList.add('hidden');
            document.getElementById('result').classList.add('hidden');
            document.getElementById('text-input').value = '';
            updateTextCounter();
            recordedChunks = [];
            document.getElementById('start-record').classList.remove('hidden');
            document.getElementById('stop-record').classList.add('hidden');
            document.getElementById('use-record').classList.add('hidden');
            document.getElementById('recording-timer').textContent = '00:00';
            if (recordingTimer) clearInterval(recordingTimer);
        }

        // Drag and Drop Handlers
        function dragOverHandler(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.add('dragover');
        }
        function dragLeaveHandler(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.remove('dragover');
        }
        function dropHandler(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.remove('dragover');
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('audio-file').files = files;
                handleFileSelect({ target: { files } });
            }
        }

        // Handle Audio File Selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('audio/')) {
                alert('Please select an audio file.');
                return;
            }
            showProgress();
            convertAudio(file);
        }

        // Text Counter Update
        function updateTextCounter() {
            const text = document.getElementById('text-input').value;
            document.getElementById('text-counter').textContent = `${text.length}/1000`;
        }

        // Clear Text Input
        function clearText() {
            document.getElementById('text-input').value = '';
            updateTextCounter();
        }

        // Start Recording
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                recordedChunks = [];

                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.start();
                document.getElementById('start-record').classList.add('hidden');
                document.getElementById('stop-record').classList.remove('hidden');

                let seconds = 0;
                recordingTimer = setInterval(() => {
                    seconds++;
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    document.getElementById('recording-timer').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }, 1000);
            } catch (err) {
                alert('Error accessing microphone: ' + err.message);
            }
        }

        // Stop Recording
        function stopRecording() {
            mediaRecorder.stop();
            clearInterval(recordingTimer);
            document.getElementById('stop-record').classList.add('hidden');
            document.getElementById('use-record').classList.remove('hidden');
        }

        // Use Recorded Audio
        function useRecording() {
            const blob = new Blob(recordedChunks, { type: 'audio/webm' });
            showProgress();
            convertAudio(blob);
        }

        // Convert Text Input
        function convertText() {
            const text = document.getElementById('text-input').value.trim();
            if (!text) {
                alert('Please enter some text.');
                return;
            }
            textToConvert = text;
            showPreview(text);
        }

        // Show Preview
        function showPreview(text) {
            document.getElementById('preview-text').textContent = text;
            document.getElementById('preview').classList.remove('hidden');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('preview').classList.add('active');
        }

        // Confirm Conversion
        function confirmConversion() {
            showProgress();
            convertTextToSign(textToConvert);
        }

        // Show Progress
        function showProgress() {
            document.getElementById('progress').classList.remove('hidden');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('progress').classList.add('active');
            let progress = 0;
            const progressFill = document.getElementById('progress-fill');
            const interval = setInterval(() => {
                progress += 10;
                if (progress <= 100) {
                    progressFill.style.width = `${progress}%`;
                }
            }, 500);
            return interval;
        }

        // Convert Audio to Sign
        function convertAudio(audio) {
            const formData = new FormData();
            formData.append('audio', audio, 'audio.webm');
            const progressInterval = showProgress();

            fetch('/convert_audio_to_sign', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                clearInterval(progressInterval);
                if (!response.ok) {
                    return response.json().then(err => { throw new Error(err.error); });
                }
                return response.blob();
            })
            .then(blob => {
                const url = URL.createObjectURL(blob);
                showResult(url);
            })
            .catch(error => {
                clearInterval(progressInterval);
                alert('Error: ' + error.message);
                newInput();
            });
        }

        // Convert Text to Sign
        function convertTextToSign(text) {
            const progressInterval = showProgress();
            fetch('/convert_text_to_sign', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text })
            })
            .then(response => {
                clearInterval(progressInterval);
                if (!response.ok) {
                    return response.json().then(err => { throw new Error(err.error); });
                }
                return response.blob();
            })
            .then(blob => {
                const url = URL.createObjectURL(blob);
                showResult(url);
            })
            .catch(error => {
                clearInterval(progressInterval);
                alert('Error: ' + error.message);
                newInput();
            });
        }

        // Show Result
        function showResult(videoUrl) {
            document.getElementById('progress').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('result').classList.add('active');
            const video = document.getElementById('sign-video');
            video.src = videoUrl;
            document.getElementById('download-video').href = videoUrl;
        }

        // Start New Input
        function newInput() {
            resetUI();
            openTab('upload');
        }

        // Initialize
        updateTextCounter();
    </script>
</body>
</html>